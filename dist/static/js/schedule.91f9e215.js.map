{"version":3,"sources":["webpack:///./src/views/schedule/schedule.vue?7678","webpack:///./src/api/schedule/index.js","webpack:///src/views/schedule/schedule.vue","webpack:///./src/views/schedule/schedule.vue?46e2","webpack:///./src/views/schedule/schedule.vue","webpack:///./src/views/schedule/schedule.vue?2eb2"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","style","height","attrs","minDate","formatter","on","selectDate","_e","detail","_v","_s","toDateFormat","workDate","class","type","statusFilter","_l","schedule","index","key","workShiftName","timeRange","mapAreaNames","staticRenderFns","workScheduleV3API","params","http","method","url","getWorkScheduleAPI","name","data","show","Date","showDetail","scheduleType","scheduleData","created","load","methods","employeeId","$toast","forEach","item","dayTime","getWorkSchedule","day","bottomInfo","className","statusOptions","v","id","result","component"],"mappings":"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","file":"static/js/schedule.91f9e215.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"schedule-content\"},[(_vm.show)?_c('van-calendar',{style:({ height: '370px' }),attrs:{\"poppable\":false,\"show-confirm\":false,\"show-mark\":true,\"min-date\":_vm.minDate,\"row-height\":48,\"formatter\":_vm.formatter},on:{\"select\":_vm.selectDate}}):_vm._e(),(_vm.detail.workDate)?_c('div',{staticClass:\"common-card padding-0\"},[_c('div',{staticClass:\"card-title style-title\"},[_c('div',[_vm._v(_vm._s(_vm.toDateFormat(_vm.detail.workDate, \"MM月dd日\"))+\"排班\")]),_c('div',{staticClass:\"status\",class:_vm.detail.type === 1 ? '' : 'un-normal'},[_vm._v(\" \"+_vm._s(_vm.statusFilter(_vm.detail.type))+\" \")])]),(_vm.showDetail)?_vm._l((_vm.detail.workSchedule),function(schedule,index){return _c('div',{key:index,staticClass:\"schedule-item\"},[_c('div',{staticClass:\"schedule-time\"},[_c('div',{staticClass:\"schedule-icon\"}),_vm._v(\" \"+_vm._s(_vm.detail.workShiftName || \"--\")+\" \"+_vm._s(schedule.timeRange[0])+\"-\"+_vm._s(schedule.timeRange[1])+\" \")]),_c('div',{staticClass:\"schedule-area\"},[_c('div',{staticClass:\"area-icon\"}),_vm._v(\" \"+_vm._s(_vm.detail.mapAreaNames || \"--\")+\" \")])])}):_vm._e()],2):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/*排班管理api*/\r\nimport http from \"@/server/http.js\";\r\n\r\n// 获取当前职员下排班详情 (从当天开始)(v3版本）\r\nexport const workScheduleV3API = params => {\r\n  return http({\r\n    method: \"GET\",\r\n    url: `/api-customer/sanitation-backend/work_schedule/v3/page`,\r\n    params\r\n  });\r\n};\r\n\r\n// 获取班次信息\r\nexport const getWorkScheduleAPI = params => {\r\n  return http({\r\n    method: \"GET\",\r\n    url: `/api-customer/staff-care/integral/getWorkSchedule`,\r\n    params\r\n  });\r\n};\r\n","<template>\r\n  <div class=\"schedule-content\">\r\n    <van-calendar\r\n      v-if=\"show\"\r\n      :poppable=\"false\"\r\n      :show-confirm=\"false\"\r\n      :show-mark=\"true\"\r\n      :min-date=\"minDate\"\r\n      :row-height=\"48\"\r\n      :style=\"{ height: '370px' }\"\r\n      :formatter=\"formatter\"\r\n      @select=\"selectDate\"\r\n    />\r\n\r\n    <div v-if=\"detail.workDate\" class=\"common-card padding-0\">\r\n      <div class=\"card-title style-title\">\r\n        <div>{{ toDateFormat(detail.workDate, \"MM月dd日\") }}排班</div>\r\n        <div class=\"status\" :class=\"detail.type === 1 ? '' : 'un-normal'\">\r\n          {{ statusFilter(detail.type) }}\r\n        </div>\r\n      </div>\r\n      <template v-if=\"showDetail\">\r\n        <div\r\n          v-for=\"(schedule, index) in detail.workSchedule\"\r\n          :key=\"index\"\r\n          class=\"schedule-item\"\r\n        >\r\n          <div class=\"schedule-time\">\r\n            <div class=\"schedule-icon\"></div>\r\n            {{ detail.workShiftName || \"--\" }} {{ schedule.timeRange[0] }}-{{\r\n              schedule.timeRange[1]\r\n            }}\r\n          </div>\r\n          <div class=\"schedule-area\">\r\n            <div class=\"area-icon\"></div>\r\n            {{ detail.mapAreaNames || \"--\" }}\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { workScheduleV3API, getWorkScheduleAPI } from \"@/api/schedule\";\r\n\r\nimport { toDateFormat } from \"@/filters/timeFormat.js\";\r\n\r\nconst statusOptions = [\r\n  { id: 1, name: \"正常\", shortName: \"班\" },\r\n  { id: 2, name: \"休息\", shortName: \"休\" },\r\n  { id: 3, name: \"请假\", shortName: \"假\" },\r\n  { id: 4, name: \"调班\", shortName: \"调\" },\r\n  { id: 5, name: \"加班\", shortName: \"加\" }\r\n];\r\n\r\nexport default {\r\n  name: \"Schedule\",\r\n  data() {\r\n    return {\r\n      toDateFormat,\r\n      show: false,\r\n      minDate: new Date(0),\r\n      showDetail: false,\r\n      detail: {},\r\n      scheduleType: {},\r\n      scheduleData: []\r\n    };\r\n  },\r\n  created() {\r\n    this.load();\r\n  },\r\n  methods: {\r\n    load() {\r\n      let employeeId = this.$store.state.userInfo.employeeId;\r\n      // let employeeId = 34501;\r\n      if (!employeeId) {\r\n        this.$toast(\"本账号未关联职员，没有排班信息！\");\r\n        return;\r\n      }\r\n      let params = { employeeIds: employeeId, pageSize: 100, page: 1 };\r\n      workScheduleV3API(params)\r\n        .then(res => {\r\n          this.scheduleData = res.data || [];\r\n          this.scheduleData.forEach(item => {\r\n            this.scheduleType[item.workDate] = item.type;\r\n          });\r\n          this.detail = this.scheduleData[0] || {};\r\n          this.getWorkSchedule(this.detail);\r\n        })\r\n        .finally(() => {\r\n          this.show = true;\r\n        });\r\n    },\r\n    selectDate(day) {\r\n      this.detail = {};\r\n      let dayTime = new Date(new Date(day).toLocaleDateString()).getTime();\r\n      this.scheduleData.forEach(item => {\r\n        if (item.workDate === dayTime) {\r\n          this.detail = item;\r\n          this.getWorkSchedule(item);\r\n        }\r\n      });\r\n    },\r\n    getWorkSchedule(item) {\r\n      if (!item.workDate) {\r\n        return;\r\n      }\r\n      this.showDetail = false;\r\n      getWorkScheduleAPI({ timestamp: item.workDate })\r\n        .then(res => {\r\n          if (\r\n            res.workScheduleDetailResponse &&\r\n            res.workScheduleDetailResponse.workShiftDto &&\r\n            res.workScheduleDetailResponse.workShiftDto.workShiftPeriods\r\n          ) {\r\n            let data =\r\n              res.workScheduleDetailResponse.workShiftDto.workShiftPeriods;\r\n            this.detail.workSchedule = [];\r\n            let baseTimestamp = 0;\r\n            data.forEach(item => {\r\n              this.detail.workSchedule.push({\r\n                timeRange: [\r\n                  toDateFormat(baseTimestamp + item.startTime, \"HH:mm\"),\r\n                  toDateFormat(baseTimestamp + item.endTime, \"HH:mm\")\r\n                ]\r\n              });\r\n            });\r\n          }\r\n        })\r\n        .finally(() => {\r\n          this.showDetail = true;\r\n        });\r\n    },\r\n    formatter(day) {\r\n      if (!this.show) {\r\n        return day;\r\n      }\r\n      let dayTime = new Date(new Date(day.date).toLocaleDateString()).getTime();\r\n      if (!this.scheduleType[dayTime]) {\r\n        return day;\r\n      }\r\n      day.bottomInfo = this.statusFilter(\r\n        this.scheduleType[dayTime],\r\n        \"shortName\"\r\n      );\r\n      day.className = this.scheduleType[dayTime] === 1 ? \"work\" : \"rest\";\r\n      return day;\r\n    },\r\n    statusFilter(v, key = \"name\") {\r\n      let result = \"--\";\r\n      statusOptions.forEach(item => {\r\n        if (v === item.id) {\r\n          result = item[key];\r\n        }\r\n      });\r\n      return result;\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.schedule-content {\r\n  padding: 0 @padding-md;\r\n  border-radius: @border-radius-md;\r\n\r\n  .card-title {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    text-align: left;\r\n    padding: @padding-sm 0 @padding-md;\r\n\r\n    .status {\r\n      border: 1px solid @blue;\r\n      padding: 2px @padding-xs;\r\n      font-size: 12px;\r\n      font-weight: normal;\r\n      border-radius: @border-radius-md;\r\n      color: @blue;\r\n\r\n      &.un-normal {\r\n        border: 1px solid @red;\r\n        color: @red;\r\n      }\r\n    }\r\n  }\r\n\r\n  .schedule-item {\r\n    text-align: left;\r\n    padding-bottom: @padding-base;\r\n    margin-bottom: @margin-sm;\r\n    border-bottom: 1px solid @gray-3;\r\n\r\n    .schedule-time,\r\n    .schedule-area {\r\n      padding-bottom: @padding-sm;\r\n      display: flex;\r\n      align-items: center;\r\n    }\r\n\r\n    .schedule-icon,\r\n    .area-icon {\r\n      width: 18px;\r\n      height: 18px;\r\n      display: inline-block;\r\n      margin-right: 4px;\r\n      background: url(\"../../assets/icons/work-schedule.png\") center / contain;\r\n    }\r\n    .area-icon {\r\n      background: url(\"../../assets/icons/work-area.png\") center / contain;\r\n    }\r\n  }\r\n\r\n  .card-item {\r\n    text-align: left;\r\n    padding: 0 @padding-md @padding-xs;\r\n  }\r\n\r\n  ::v-deep {\r\n    .van-calendar {\r\n      margin-top: @margin-sm;\r\n      box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.15);\r\n      border-radius: @border-radius-lg;\r\n    }\r\n\r\n    .van-calendar__header-title {\r\n      display: none;\r\n    }\r\n\r\n    .van-calendar__month-title {\r\n      color: white;\r\n    }\r\n\r\n    .van-calendar__day {\r\n      align-items: flex-start;\r\n      line-height: 32px;\r\n    }\r\n    .van-calendar__selected-day {\r\n      align-items: flex-start;\r\n      background: rgba(19, 168, 168, 0.6);\r\n    }\r\n\r\n    .work {\r\n      .van-calendar__bottom-info {\r\n        color: @blue;\r\n      }\r\n    }\r\n\r\n    .rest {\r\n      .van-calendar__bottom-info {\r\n        color: @red;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./schedule.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./schedule.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./schedule.vue?vue&type=template&id=35aaa792&scoped=true&\"\nimport script from \"./schedule.vue?vue&type=script&lang=js&\"\nexport * from \"./schedule.vue?vue&type=script&lang=js&\"\nimport style0 from \"./schedule.vue?vue&type=style&index=0&id=35aaa792&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"35aaa792\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./schedule.vue?vue&type=style&index=0&id=35aaa792&scoped=true&lang=less&\""],"sourceRoot":""}